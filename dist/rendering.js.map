{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","panel","dashboard","plot","find","$tooltip","$","grayColor","events","on","renderData","render","destroy","bind","event","ranges","$apply","timeSrv","setTime","from","moment","utc","xaxis","to","mouseleave","clearTooltip","appEvents","emit","sharedTooltipModeEnabled","evt","id","otherPanelInFullscreenMode","showToolpit","pos","info","setElementHeight","css","height","e","console","log","time_format","ticks","min","max","range","secPerTick","oneDay","oneYear","render_panel","refreshTooltip","series","length","empty","appendTo","panelWidth","width","panelHeight","plotCanvas","plotCss","top","left","margin","position","gridColor","lineWidth","widthMode","_","floor","stats","count","candlestickWidth","isUndefined","valueOf","zIndexes","secondYaxis","i","undefined","getFlotPairs","nullPointMode","zindex","yaxis","yaxes","index","logBase","show","swapYaxes","axisLabel","labelY1","push","labelY2","options","legend","bars","align","lines","zero","candlestick","active","rangeWidth","rangeColor","mode","solidColor","barColor","upColor","bearColor","downColor","bullColor","neutralColor","dojiColor","drawCandlestick","newDrawCandlestick","nearBy","timezone","getTimezone","label","timeformat","grid","minBorderMargin","markings","backgroundColor","borderWidth","hoverable","clickable","color","right","labelMarginX","selection","crosshair","candleData","high","low","datas","pushData","fill","points","barWidth","getMinTimeStepOfSeries","fillColor","radius","flotpairs","pushIndicators","begin","end","inx","findItem","html","item","panelRelY","pageY","offset","Number","MAX_VALUE","timeStep","pointOffset","x","isNaN","pageX","isVisible","window","scrollTop","innerHeight","setCrosshair","sharedCrosshairModeOnly","seriesItem","value","line","seriesHtml","len","datapoints","posX","absoluteTime","formatDate","tooltipFormat","body","formatValue","colorizeTooltip","plotData","getData","j","alias","place_tt","transparentTooltip","detach","clearCrosshair","unhighlight","ctx","serie","hover","drawRange","drawBody","getColor","p2c","y1","y2","beginPath","strokeStyle","moveTo","lineTo","y3","y4","stroke","half","incrementRenderCounter","renderingCompleted"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport 'jquery.flot';\nimport { appEvents } from 'app/core/core';\nimport './vendor/jquery_flot_candlestick';\nimport './vendor/jquery_flot_axislabels';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel, dashboard, plot;\n  elem = elem.find('.candlestick-panel');\n  var $tooltip = $('<div class=\"graph-tooltip\">');\n  var grayColor = '#c8c9ca';\n\n  ctrl.events.on('render', renderData => {\n    data = renderData || data;\n    if (!data) {\n      return;\n    }\n\n    render(false);\n  });\n\n  ctrl.events.on('panel-teardown', () => {\n    if (plot) {\n      plot.destroy();\n      plot = null;\n    }\n  });\n\n  elem.bind('plotselected', function(event, ranges) {\n    scope.$apply(function() {\n      scope.ctrl.timeSrv.setTime({\n        from: moment.utc(ranges.xaxis.from),\n        to: moment.utc(ranges.xaxis.to),\n      });\n    });\n  });\n\n  elem.mouseleave(function() {\n    if (plot) {\n      clearTooltip();\n    }\n    appEvents.emit('graph-hover-clear');\n  });\n\n  appEvents.on(\n    'graph-hover',\n    evt => {\n      // ignore other graph hover events if shared tooltip is disabled\n      if (!dashboard || !dashboard.sharedTooltipModeEnabled()) {\n        return;\n      }\n\n      // ignore if we are the emitter\n      if (!plot || evt.panel.id === panel.id || ctrl.otherPanelInFullscreenMode()) {\n        return;\n      }\n\n      showToolpit(evt.pos);\n    },\n    scope\n  );\n\n  appEvents.on(\n    'graph-hover-clear',\n    (event, info) => {\n      if (plot) {\n        clearTooltip();\n      }\n    },\n    scope\n  );\n\n  function setElementHeight() {\n    try {\n      elem.css('height', ctrl.height + 'px');\n\n      return true;\n    } catch (e) { // IE throws errors sometimes\n      console.log(e);\n      return false;\n    }\n  }\n\n  function time_format(ticks, min, max) {\n    if (min && max && ticks) {\n      let range = max - min;\n      let secPerTick = range / ticks / 1000;\n      const oneDay = 86400000;\n      const oneYear = 31536000000;\n\n      if (secPerTick <= 45) {\n        return '%H:%M:%S';\n      }\n      if (secPerTick <= 7200 || range <= oneDay) {\n        return '%H:%M';\n      }\n      if (secPerTick <= 80000) {\n        return '%m/%d %H:%M';\n      }\n      if (secPerTick <= 2419200 || range <= oneYear) {\n        return '%m/%d';\n      }\n      return '%Y-%m';\n    }\n\n    return '%H:%M';\n  }\n\n  function render_panel() {\n    refreshTooltip();\n\n    data = ctrl.series;\n\n    // return \"no data points\" when datapoints are not loaded.\n    if (data.length < 4) {\n      $(elem).empty();\n      $('<div class=\"datapoints-warning flot-temp-elem\">No data points</div>').appendTo(elem);\n      return;\n    }\n\n    let panelWidth = elem.width();\n    let panelHeight = elem.height();\n\n    let plotCanvas = $('<div></div>');\n    let plotCss = {\n      top: '10px',\n      left: '0px',\n      margin: 'auto',\n      position: 'relative',\n      width: panelWidth + 'px',\n      height: (panelHeight - 20) + 'px',\n    };\n\n    plotCanvas.css(plotCss);\n\n    const gridColor = '#c8c8c8';\n    let lineWidth =\n      panel.widthMode === 'auto' ?\n        _.floor(panelWidth / (1.5 * data[0].stats.count)) :\n        panel.candlestickWidth;\n    if (!lineWidth) {\n      lineWidth = 9;\n    }\n\n    let ticks = panelWidth / 100;\n    let min = _.isUndefined(ctrl.range.from) ? null : ctrl.range.from.valueOf();\n    let max = _.isUndefined(ctrl.range.to) ? null : ctrl.range.to.valueOf();\n\n    let zIndexes = [0, 0, 0, 0, 0, 0];\n    let secondYaxis = false;\n    for (var i = 0; i < data.length; i++) {\n      let series = data[i];\n      if (series !== undefined) {\n        series.data = series.getFlotPairs(series.nullPointMode || panel.nullPointMode);\n      }\n      if (i < 4) {\n        continue;\n      }\n      data[i].zindex = 'zindex' in data[i] && data[i].zindex !== undefined ? data[i].zindex : 0;\n      zIndexes[data[i].zindex + 3]++;\n      data[i].yaxis = 'yaxis' in data[i] && data[i].yaxis === 2 ? 2 : 1;\n      secondYaxis |= data[i].yaxis === 2;\n    }\n\n    let yaxes = [{\n      index: 1,\n      logBase: 1,\n      show: true,\n      position: panel.swapYaxes ? 'right' : 'left',\n      axisLabel: panel.labelY1,\n    }];\n    if (secondYaxis) {\n      yaxes.push({\n        index: 2,\n        logBase: 1,\n        show: true,\n        position: panel.swapYaxes ? 'left' : 'right',\n        axisLabel: panel.labelY2,\n      });\n    }\n\n    let options = {\n      legend: {\n        show: false,\n      },\n      series: {\n        bars: {\n          show: false,\n          align: 'left',\n        },\n        lines: {\n          show: false,\n          zero: false,\n        },\n        candlestick: {\n          active: true,\n          show: true,\n          lineWidth: lineWidth + 'px',\n          rangeWidth: 1,\n          rangeColor: panel.mode === 'solid' ? panel.solidColor : panel.barColor,\n          upColor: panel.mode === 'color' ? panel.bearColor : panel.solidColor,\n          downColor: panel.mode === 'color' ? panel.bullColor : panel.solidColor,\n          neutralColor: panel.mode === 'color' ? panel.dojiColor : panel.solidColor,\n          drawCandlestick: newDrawCandlestick,\n        },\n        nearBy: {\n        },\n      },\n      yaxes: yaxes,\n      xaxis: {\n        timezone: dashboard.getTimezone(),\n        show: true,\n        mode: 'time',\n        label: 'Datetime',\n        min: min,\n        max: max,\n        ticks: ticks,\n        timeformat: time_format(ticks, min, max),\n      },\n      grid: {\n        minBorderMargin: 0,\n        markings: [],\n        backgroundColor: null,\n        borderWidth: 0,\n        hoverable: true,\n        clickable: true,\n        color: gridColor,\n        margin: { left: 0, right: 0 },\n        labelMarginX: 0,\n      },\n      selection: {\n        mode: 'x',\n        color: '#666',\n      },\n      crosshair: {\n        mode: 'x',\n      },\n    };\n\n    let candleData = [], high = [], low = [];\n\n    for (i = 0; i < data[0].data.length; i++) {\n      candleData.push([\n        data[0].data[i][0],\n        data[0].data[i][1],\n        data[1].data[i][1],\n        data[2].data[i][1],\n        data[3].data[i][1]\n      ]);\n      low.push([data[0].data[i][0], data[2].data[i][1]]);\n      high.push([data[0].data[i][0], data[3].data[i][1]]);\n    }\n\n    var datas = [];\n\n    var pushData = function(i) {\n      var fill = data[i].lines && data[i].lines.fill !== undefined ? data[i].lines.fill : 0;\n      datas.push({\n        lines: {\n          show: data[i].lines.show || !(data[i].points.show || data[i].bars.show),\n          zero: false,\n          lineWidth: data[i].lines && data[i].lines.lineWidth !== undefined ? data[i].lines.lineWidth : 1,\n          fill: fill\n        },\n        bars: {\n          show: data[i].bars.show,\n          fill: fill !== 0 ? fill : 1,\n          barWidth: getMinTimeStepOfSeries(data) / 1.5,\n          zero: false,\n          lineWidth: data[i].lines && data[i].lines.lineWidth !== undefined ? data[i].lines.lineWidth : 1,\n          align: 'left'\n        },\n        points: {\n          show: data[i].points.show,\n          fill: fill !== 0 ? fill : 1,\n          fillColor: false,\n          radius: data[i].points && data[i].points.radius !== undefined ? data[i].points.radius : 5\n        },\n        data: data[i].flotpairs,\n        color: data[i].color,\n        yaxis: data[i].yaxis,\n        hoverable: false\n      });\n    };\n\n    var pushIndicators = function(begin, end) {\n      if (data.length > 4) {\n        for (var inx = begin + 3; inx <= end + 3; inx++) {\n          if (zIndexes[inx] === 0) {\n            continue;\n          }\n\n          for (i = 4; i < data.length; i++) {\n            if (inx - data[i].zindex !== 3) {\n              continue;\n            }\n            pushData(i);\n            zIndexes[inx]--;\n            if (zIndexes[inx] === 0) {\n              break;\n            }\n          }\n        }\n      }\n    };\n\n    pushIndicators(-3, -1);\n\n    datas.push({\n      candlestick: {\n        show: true\n      },\n      data: candleData,\n      hoverable: true,\n    }, {\n      label: 'High',\n      data: high,\n      lines: {\n        show: false\n      },\n      candlestick: {\n        show: false\n      },\n      nearBy: {\n        findItem: null\n      }\n    }, {\n      label: 'Low',\n      data: low,\n      lines: {\n        show: false\n      },\n      candlestick: {\n        show: false\n      },\n      nearBy: {\n        findItem: null\n      }\n    });\n\n    pushIndicators(0, 3);\n\n    elem.html(plotCanvas);\n\n    plot = $.plot(plotCanvas, datas, options);\n\n    plotCanvas.bind('plothover', function(event, pos, item) {\n      showToolpit(pos);\n\n      // broadcast to other graph panels that we are hovering!\n      pos.panelRelY = (pos.pageY - elem.offset().top) / elem.height();\n      appEvents.emit('graph-hover', {pos: pos, panel: panel});\n    });\n  }\n\n  function getMinTimeStepOfSeries(data) {\n    var min = Number.MAX_VALUE;\n\n    for (let i = 0; i < data.length; i++) {\n      if (!data[i].stats.timeStep) {\n        continue;\n      }\n      if (panel.bars) {\n        if (data[i].bars && data[i].bars.show === false) {\n          continue;\n        }\n      } else {\n        if (typeof data[i].bars === 'undefined' || typeof data[i].bars.show === 'undefined' || !data[i].bars.show) {\n          continue;\n        }\n      }\n\n      if (data[i].stats.timeStep < min) {\n        min = data[i].stats.timeStep;\n      }\n    }\n\n    return min;\n  }\n\n  function showToolpit(pos) {\n    if (data.length < 4) {\n      return;\n    }\n\n    // if panelRelY is defined another panel wants us to show a tooltip\n    // get pageX from position on x axis and pageY from relative position in original panel\n    if (pos.panelRelY) {\n      let pointOffset = plot.pointOffset({x: pos.x});\n      if (Number.isNaN(pointOffset.left) || pointOffset.left < 0 || pointOffset.left > elem.width()) {\n        clearTooltip();\n        return;\n      }\n      pos.pageX = elem.offset().left + pointOffset.left;\n      pos.pageY = elem.offset().top + elem.height() * pos.panelRelY;\n      let isVisible =\n        pos.pageY >= $(window).scrollTop() &&\n        pos.pageY <= $(window).innerHeight() + $(window).scrollTop();\n      if (!isVisible) {\n        clearTooltip();\n        return;\n      }\n      plot.setCrosshair(pos);\n\n      if (dashboard.sharedCrosshairModeOnly()) {\n        // if only crosshair mode we are done\n        return;\n      }\n    }\n\n    let seriesItem = function(label, value, color, line) {\n      let seriesHtml = '<div class=\"graph-tooltip-list-item\">';\n      if (line) {\n        seriesHtml += '<div class=\"graph-tooltip-series-name\">' +\n          '<i class=\"fa fa-minus\" style=\"color:' + color + ';\"></i> ' + label + ':</div>';\n      } else {\n        seriesHtml += '<div class=\"graph-tooltip-series-name\" style=\"color:' + color + ';\">' + label + ':</div>';\n      }\n      seriesHtml += '<div class=\"graph-tooltip-value\">' + value + '</div></div>';\n      return seriesHtml;\n    };\n    const len = data[0].datapoints.length;\n    let offset = 0;\n    if (len > 0) {\n      offset = data[0].datapoints[1][1] - data[0].datapoints[0][1];\n    }\n    const posX = pos.x - offset;\n    for (var i = 0; i < len; i++) {\n      if (posX <= data[0].datapoints[i][1]) {\n        break;\n      }\n    }\n    i = i ? i < len ? i : len - 1 : 0;\n\n    const absoluteTime = dashboard.formatDate(data[0].datapoints[i][1], panel.tooltipFormat);\n\n    let body = '<div class=\"graph-tooltip-time\">' + absoluteTime + '</div>' +\n      seriesItem('Open', formatValue(data[0].datapoints[i][0]), grayColor, false) +\n      seriesItem('High', formatValue(data[3].datapoints[i][0]),\n        panel.colorizeTooltip && panel.mode === 'color' ? panel.bullColor : grayColor, false) +\n      seriesItem('Low', formatValue(data[2].datapoints[i][0]),\n        panel.colorizeTooltip && panel.mode === 'color' ? panel.bearColor : grayColor, false) +\n      seriesItem('Close', formatValue(data[1].datapoints[i][0]), grayColor, false);\n\n    if (data.length > 4) {\n      body += '<div style=\"height: 2px; margin-top: 2px; border-top: solid 1px ' + grayColor + ';\"></div>';\n      let plotData = plot.getData();\n      var value;\n      for (let j = 4; j < data.length; j++) {\n        if (data[j].datapoints.length === 1) {\n          value = data[j].datapoints[0][0];\n        } else if (data[j].datapoints[i] === undefined) {\n          continue;\n        } else {\n          value = data[j].datapoints[i][0];\n        }\n        body += seriesItem(data[j].alias, formatValue(value), data[j].color, true);\n      }\n    }\n\n    $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  }\n\n  function refreshTooltip() {\n    $($tooltip).css('opacity', panel.transparentTooltip ? 0.75 : 1);\n  }\n\n  function clearTooltip() {\n    $tooltip.detach();\n    plot.clearCrosshair();\n    plot.unhighlight();\n  }\n\n  function formatValue(value) {\n    // switch (true) {\n    //   case (value >= 100):\n    //     return data[0].formatValue(value);\n    //   case (value >= 1):\n    //     return Math.round(value * 1000) / 1000;\n    //   case (value > 0.1):\n    //     return Math.round(value * 10000) / 10000;\n    //   case (value > 0.01):\n    //     return Math.round(value * 100000) / 100000;\n    //   case (value > 0.001):\n    //     return Math.round(value * 1000000) / 1000000;\n    //   case (value > 0.0001):\n    //     return Math.round(value * 10000000) / 10000000;\n    //   case (value > 0.00001):\n    //     return Math.round(value * 100000000) / 100000000;\n    //   case (value > 0.000001):\n    //     return Math.round(value * 1000000000) / 1000000000;\n    // }\n\n    return value;\n  }\n\n  function newDrawCandlestick(ctx, serie, data, hover) {\n    if (data.length < 5) {\n      return;\n    }\n\n    drawRange(ctx, serie, data);\n    drawBody(ctx, serie, data);\n\n    function getColor(ctx, serie, data) {\n      if (panel.mode === 'color') {\n        if (data[1] === data[2]) {\n          return serie.candlestick.neutralColor;\n        } else {\n          return data[1] > data[2] ? serie.candlestick.upColor : serie.candlestick.downColor;\n        }\n      }\n\n      return serie.candlestick.rangeColor;\n    }\n\n    function drawRange(ctx, serie, data) {\n      let x = serie.xaxis.p2c(data[0]) + serie.candlestick.barWidth / 2;\n      let y1 = serie.yaxis.p2c(data[3]);\n      let y2 = serie.yaxis.p2c(data[4]);\n      ctx.lineWidth = serie.candlestick.rangeWidth;\n      ctx.beginPath();\n      ctx.strokeStyle = getColor(ctx, serie, data);\n      switch (panel.mode) {\n        case 'color':\n        case 'bar':\n          ctx.moveTo(x, y1);\n          ctx.lineTo(x, y2);\n          break;\n        case 'solid':\n          let y3 = serie.yaxis.p2c(data[1]);\n          let y4 = serie.yaxis.p2c(data[2]);\n          ctx.moveTo(x, y1);\n          ctx.lineTo(x, y3);\n          ctx.moveTo(x, y4);\n          ctx.lineTo(x, y2);\n          break;\n      }\n      ctx.stroke();\n    }\n\n    function drawBody(ctx, serie, data) {\n      let half = serie.candlestick.barWidth / 2;\n      let x = serie.xaxis.p2c(data[0]) + half;\n      let y1 = serie.yaxis.p2c(data[1]);\n      let y2 = serie.yaxis.p2c(data[2]);\n      if (data[1] === data[2] && panel.mode !== 'bar') {\n        y2 = y1 + 1;\n      }\n      ctx.beginPath();\n      ctx.strokeStyle = getColor(ctx, serie, data);\n      switch (panel.mode) {\n        case 'color':\n          ctx.lineWidth = serie.candlestick.barWidth;\n          ctx.moveTo(x, y1);\n          ctx.lineTo(x, y2);\n          break;\n        case 'solid':\n          ctx.moveTo(x, y1);\n          if (data[1] >= data[2]) {\n            ctx.lineWidth = serie.candlestick.barWidth;\n            ctx.lineTo(x, y2);\n          } else {\n            ctx.lineWidth = serie.candlestick.rangeWidth;\n            ctx.lineTo(x + half, y1);\n            ctx.lineTo(x + half, y2);\n            ctx.lineTo(x - half, y2);\n            ctx.lineTo(x - half, y1);\n            ctx.lineTo(x, y1);\n          }\n          break;\n        case 'bar':\n          ctx.lineWidth = serie.candlestick.rangeWidth;\n          ctx.moveTo(x - half, y1);\n          ctx.lineTo(x, y1);\n          ctx.moveTo(x + half, y2);\n          ctx.lineTo(x, y2);\n          break;\n      }\n      ctx.stroke();\n    }\n  }\n\n  function render(incrementRenderCounter) {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n    dashboard = ctrl.dashboard;\n\n    if (setElementHeight()) {\n        render_panel();\n    }\n    if (incrementRenderCounter) {\n      ctrl.renderingCompleted();\n    }\n  }\n}\n"]}